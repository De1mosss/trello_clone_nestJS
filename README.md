# Документация проекта Trello Clone (NestJS)

## Обзор проекта

Это REST API приложение, реализующее функциональность клона Trello, построенное на фреймворке NestJS с использованием Prisma ORM и PostgreSQL в качестве базы данных. 

## Технологический стек

- **Backend Framework**: NestJS 11.0.1
- **ORM**: Prisma 6.18.0
- **База данных**: PostgreSQL
- **Аутентификация**: JWT (JSON Web Tokens) с Passport
- **Хеширование паролей**: bcrypt
- **Язык**: TypeScript 

## Архитектура приложения

Приложение использует модульную архитектуру NestJS и состоит из следующих основных модулей:

- **AuthModule** - аутентификация и авторизация пользователей
- **UsersModule** - управление пользователями
- **ColumnsModule** - управление колонками (списками задач)
- **CardsModule** - управление карточками (задачами)
- **CommentsModule** - управление комментариями к карточкам
- **PrismaModule** - интеграция с Prisma ORM

## Модель данных

### User (Пользователь)
- `id`: уникальный идентификатор
- `email`: email пользователя (уникальный)
- `password`: хешированный пароль
- `createdAt`: дата создания
- `updatedAt`: дата обновления
- Связи: имеет множество колонок, карточек и комментариев  

### Column (Колонка)
- `id`: уникальный идентификатор
- `title`: название колонки
- `userId`: ID владельца колонки
- `createdAt`: дата создания
- `updatedAt`: дата обновления
- Связи: принадлежит пользователю, содержит множество карточек 

### Card (Карточка)
- `id`: уникальный идентификатор
- `title`: название карточки
- `description`: описание (опционально)
- `userId`: ID создателя
- `columnId`: ID колонки
- `createdAt`: дата создания
- `updatedAt`: дата обновления
- Связи: принадлежит пользователю и колонке, содержит множество комментариев 

### Comment (Комментарий)
- `id`: уникальный идентификатор
- `content`: текст комментария
- `userId`: ID автора
- `cardId`: ID карточки
- `createdAt`: дата создания
- Связи: принадлежит пользователю и карточке (каскадное удаление) 

## API Endpoints

### Аутентификация (`/auth`)

#### POST `/auth/register`
Регистрация нового пользователя.

**Тело запроса:**
```json
{
  "email": "string",
  "password": "string"
}
```

**Ответ:** Данные пользователя без пароля 

Пароль хешируется с использованием bcrypt перед сохранением в базу данных. 
#### POST `/auth/login`
Вход пользователя в систему.

**Тело запроса:**
```json
{
  "email": "string",
  "password": "string"
}
```

**Ответ:** JWT токен доступа 

Токен действителен в течение 1 часа.

### Колонки (`/columns`)

Все endpoints требуют JWT аутентификации через Bearer Token.

#### POST `/columns`
Создание новой колонки.

**Тело запроса:**
```json
{
  "title": "string"
}
``` 

#### GET `/columns`
Получение всех колонок текущего пользователя (с включенными карточками). 
#### PATCH `/columns/:id`
Обновление колонки.

**Параметры:** `id` - ID колонки

**Тело запроса:**
```json
{
  "title": "string"
}
```

Проверяется владение колонкой перед обновлением. 

#### DELETE `/columns/:id`
Удаление колонки.

**Параметры:** `id` - ID колонки

Проверяется владение колонкой перед удалением. 

### Карточки (`/cards`)

Все endpoints требуют JWT аутентификации. 

#### POST `/cards`
Создание новой карточки.

**Тело запроса:**
```json
{
  "columnId": number,
  "title": "string",
  "description": "string" // опционально
}
``` 

#### GET `/cards/:columnId`
Получение всех карточек в колонке (отсортированы по дате создания по убыванию).

#### PATCH `/cards/:id`
Обновление карточки.

**Параметры:** `id` - ID карточки

**Тело запроса:**
```json
{
  "title": "string",
  "description": "string"
}
```

Проверяется владение карточкой перед обновлением. 

#### DELETE `/cards/:id`
Удаление карточки.

**Параметры:** `id` - ID карточки

Проверяется владение карточкой перед удалением. 

### Комментарии (`/comments`)

Все endpoints требуют JWT аутентификации. 

#### POST `/comments`
Создание нового комментария.

**Тело запроса:**
```json
{
  "cardId": number,
  "content": "string"
}
``` 

#### GET `/comments/:cardId`
Получение всех комментариев к карточке (отсортированы по дате создания по возрастанию). 

#### PATCH `/comments/:id`
Обновление комментария.

**Параметры:** `id` - ID комментария

**Тело запроса:**
```json
{
  "content": "string"
}
```

Проверяется авторство комментария перед обновлением. 

#### DELETE `/comments/:id`
Удаление комментария.

**Параметры:** `id` - ID комментария

Проверяется авторство комментария перед удалением. 

## Аутентификация и Авторизация

### JWT Strategy
Приложение использует JWT токены для аутентификации. Токен передается в заголовке `Authorization` как Bearer Token. 

Секретный ключ для подписи токенов берется из переменной окружения `JWT_SECRET` или используется значение по умолчанию. 

Валидация токена извлекает `userId` и `email` из payload. 

## Установка и запуск

### Установка зависимостей
```bash
npm install
``` 

### Команды для запуска

- **Режим разработки**: `npm run start:dev` - запуск с автоматической перезагрузкой
- **Режим отладки**: `npm run start:debug` - запуск с отладчиком
- **Продакшн**: `npm run start:prod` - запуск скомпилированного приложения 

### Тестирование

- **Unit тесты**: `npm run test`
- **E2E тесты**: `npm run test:e2e`
- **Покрытие тестами**: `npm run test:cov` 

### Конфигурация

Приложение запускается на порту 3000 по умолчанию (или на порту из переменной окружения `PORT`). 

### База данных

Приложение использует PostgreSQL через Prisma ORM. Строка подключения берется из переменной окружения `DATABASE_URL`. 

Prisma Service автоматически подключается при инициализации модуля и отключается при его уничтожении. 

## Безопасность

### Хеширование паролей
Пароли хешируются с использованием bcrypt с salt rounds = 10 перед сохранением в базу данных. 

### Проверка прав доступа
Все операции с колонками, карточками и комментариями проверяют владение ресурсом. При попытке доступа к чужим ресурсам возвращается ошибка `ForbiddenException`. 

### Обработка ошибок
Приложение использует стандартные исключения NestJS:
- `NotFoundException` - ресурс не найден
- `ForbiddenException` - нет прав доступа
- `UnauthorizedException` - ошибки аутентификации 

## Notes

Проект представляет собой полноценный REST API для управления задачами в стиле Trello с системой аутентификации, пользовательскими правами и полным CRUD функционалом для колонок, карточек и комментариев. 

Все защищенные endpoints требуют JWT токен в заголовке Authorization. Проект следует лучшим практикам NestJS с разделением на модули, контроллеры и сервисы. Используется Prisma ORM для типобезопасной работы с базой данных PostgreSQL.

Для работы приложения необходимо настроить переменные окружения:
- `DATABASE_URL` - строка подключения к PostgreSQL
- `JWT_SECRET` - секретный ключ для подписи JWT токенов (опционально, есть значение по умолчанию)
- `PORT` - порт приложения (опционально, по умолчанию 3000)

